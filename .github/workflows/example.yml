name: workflow to create an Azure VM, build and run the bullhorn application through npm with node.js and angular.

on:
  pull_request:
  branches:
    - master

env:
  AZURE_RESOURCE_GROUP: Bullhorn-DEV
  AZURE_ARM_PATH: 'https://github.com/brianveltman/bullhorn-poc/tree/master/ARM-template/template.json'
  AZURE_ARMPARA_PATH: 'https://github.com/brianveltman/bullhorn-poc/tree/master/ARM-template/parameters.json'

jobs:
  build-and-deploy-to-dev:
    runs-on: ubuntu-latest
    steps:

    - uses: actions/checkout@master

    - uses: azure/actions/login@v1
      with:
        creds: [${{ secrets.azure_client_id  }},
                ${{ secrets.azure_client_secret  }},
                ${{ secrets.azure_subscription_id  }},
                ${{ secrets.azure_tenant_id  }}]

    - run:
        az group deployment create \
        --resource-group ${{ env.AZURE_RESOURCE_GROUP }} \
        --template-file ${{ env.AZURE_ARM_PATH }} \
        --parameters ${{ env.AZURE_ARMPARA_PATH }} 

    - name: logout
      run: |
        az logout